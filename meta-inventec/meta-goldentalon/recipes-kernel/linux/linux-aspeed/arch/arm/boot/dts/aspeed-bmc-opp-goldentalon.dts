// SPDX-License-Identifier: GPL-2.0-or-later
// Copyright 2019 IBM Corp.

/dts-v1/;

#include "aspeed-g6.dtsi"
#include <dt-bindings/i2c/i2c.h>
#include <dt-bindings/gpio/aspeed-g6-gpio.h>

/ {
	model = "AST2600 EVB";
	compatible = "aspeed,ast2600";

	aliases {
		serial4 = &uart5;
	};

	chosen {
		bootargs = "console=ttyS4,115200n8";
	};

	memory@80000000 {
		device_type = "memory";
		reg = <0x80000000 0x80000000>;
	};

        leds {
                compatible = "gpio-leds";

                // UID led
                uid {
                    label = "UID_LED";
                    gpios = <&gpio0 ASPEED_G6_GPIO(G, 0) GPIO_ACTIVE_LOW>;
                };

                // Heart beat led
                heartbeat {
                    label = "HB_LED";
                    gpios = <&gpio0 ASPEED_G6_GPIO(P, 7) GPIO_ACTIVE_LOW>;
                };

                // Fault led
                plt_fault {
                    label = "FAULT_LED";
                    gpios = <&gpio0 ASPEED_G6_GPIO(S, 7) GPIO_ACTIVE_LOW>;
                };

                // Power on led
                pwron {
                    label = "PWR_ON_LED";
                    gpios = <&gpio0 ASPEED_G6_GPIO(L, 6) GPIO_ACTIVE_LOW>;
                };

                // Power fail led
                pwrfail {
                    label = "PWR_FAIL_LED";
                    gpios = <&gpio0 ASPEED_G6_GPIO(I, 6) GPIO_ACTIVE_LOW>;
                };
        };
};




&mdio0 {
    status = "okay";

    ethphy0: ethernet-phy@0 {
	compatible = "ethernet-phy-ieee802.3-c22";
	reg = <8>;
    };
};

&mac0 {
    status = "okay";

    phy-mode = "rgmii";
    phy-handle = <&ethphy0>;

    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_rgmii1_default>;
};

#if 0

&mac2 {
	status = "okay";

	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_rmii3_default>;
	use-ncsi;
};

#endif

&peci{
	peci0: peci-bus@0{
		status = "okay";

		peci-client@30 {
			compatible = "intel,peci-client";
			reg = <0x30>;
		};
	};
};


&rtc {
	status = "okay";
};

&fmc {
	status = "okay";
	flash@0 {
		status = "okay";
		m25p,fast-read;
		label = "bmc";
		spi-max-frequency = <33333334>;
		spi-bus-width = <2> ;

		partitions {
			compatible = "fixed-partitions";
			#address-cells = <1>;
			#size-cells = <1>;

			u-boot@0 {
				reg = <0x0 0xe0000>; // 896KB
				label = "u-boot";
			};

			u-boot-env@e0000 {
				reg = <0xe0000 0x20000>; // 128KB
				label = "u-boot-env";
			};

			kernel@100000 {
				reg = <0x100000 0x900000>; // 9MB
				label = "kernel";
			};

			rofs@a00000 {
				reg = <0xa00000 0x2000000>; // 32MB
				label = "rofs";
			};

			rwfs@2a00000 {
				reg = <0x2a00000 0x1600000>; // 22MB
				label = "rwfs";
			};
		};
	};
	flash@1 {
		status = "okay";
		label = "bmc2";
		m25p,fast-read;
		spi-max-frequency = <33333334>;
		spi-bus-width = <2> ;
	};
};

&spi1 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_spi1_default>;

	flash@0 {
		status = "okay";
		m25p,fast-read;
		label = "bios";
		spi-max-frequency = <33333334>;
		spi-bus-width = <2> ;
	};
};

&uart5 {
	// Workaround for A0
	compatible = "snps,dw-apb-uart";
};

&uart1 {
	// Workaround for A0
	compatible = "snps,dw-apb-uart";
	status = "okay";
};

&uart2 {
	// Workaround for A0
	compatible = "snps,dw-apb-uart";
	status = "okay";
};

&uart3 {
	// Workaround for A0
	compatible = "snps,dw-apb-uart";
	status = "okay";
};

&uart4 {
	// Workaround for A0
	compatible = "snps,dw-apb-uart";
	status = "okay";
};

&lpc_ctrl {
	// Enable lpc clock
	status = "okay";
};

&lpc_snoop {
	status = "okay";
	snoop-ports = <0x80>;
};

&vuart1 {
	// VUART Host Console
	status = "okay";
};

&kcs1 {
	// BMC KCS channel 1
	status = "okay";
	aspeed,lpc-io-reg  = <0xca0>;

};

&kcs2 {
	// BMC KCS channel 2
	status = "okay";
	aspeed,lpc-io-reg  = <0xca8>;
};

&kcs3 {
	// BMC KCS channel 3
	status = "okay";
	aspeed,lpc-io-reg  = <0xca2>;
};

&i2c0 {
	status = "okay";

	adt7462@58 {
		compatible = "adt7462";
		reg = <0x58>;
	};

	adt7462@5c {
		compatible = "adt7462";
		reg = <0x5c>;
	};
};

&i2c1 {
	status = "okay";

	//Blade Inlet0
	inlet0: tmp421@1c {
		compatible = "ti,tmp421";
		reg = <0x1c>;
	};

	//Blade Inlet1
	inlet1: tmp421@1d {
		compatible = "ti,tmp421";
		reg = <0x1d>;
	};

	//Blade Inlet2
	inlet2: tmp421@1e {
		compatible = "ti,tmp421";
		reg = <0x1e>;
	};

	//Blade Outlet0
	outlet0: tmp421@4c {
		compatible = "ti,tmp421";
		reg = <0x4c>;
	};

	//Blade Outlet1
	outlet1: tmp421@4d {
		compatible = "ti,tmp421";
		reg = <0x4d>;
	};

	//Blade Outlet2
	outlet2: tmp421@4e {
		compatible = "ti,tmp421";
		reg = <0x4e>;
	};

	// //Fan controller
	fanc1: max31790@2c {
		compatible = "maxim,max31790";
		reg = <0x2c>;
		// #address-cells = <1>;
		// #size-cells = <0>;
		// fan-mode = "pwm";
		// fanconfig1 = <0x08>;
		// fanconfig2 = <0x08>;
		// fanconfig3 = <0x08>;
		// fanconfig4 = <0x08>;
		// fanconfig5 = <0x08>;
		// fanconfig6 = <0x08>;
	};
	fanc2: max31790@2f {
		compatible = "maxim,max31790";
		reg = <0x2f>;
		// #address-cells = <2>;
		// #size-cells = <0>;
		// fan-mode = "pwm";
		// fanconfig1 = <0x08>;
		// fanconfig2 = <0x08>;
		// fanconfig3 = <0x08>;
		// fanconfig4 = <0x08>;
		// fanconfig5 = <0x08>;
		// fanconfig6 = <0x08>;
	};

	// //GPIO Expander MAX7311
	// efuse_ftl: max7311@22 {
	// 	compatible = "max7311";
	// 	reg = <0x22>;
	// };
	// gpio_expander: max7311@23 {
	// 	compatible = "max7311";
	// 	reg = <0x23>;
	// };
};

&i2c2 {
	status = "okay";

	//Set bmc' slave address;
	bmc_slave@10 {
		compatible = "ipmb-dev";
		reg = <(0x10 | I2C_OWN_SLAVE_ADDRESS)>;
		i2c-protocol;
	};
};

&i2c3 {
	status = "okay";

	/* HPM FRU */
	fru: eeprom@54 {
		compatible = "atmel,24c64";
		reg = <0x54>;
		pagesize = <32>;
	};
};

&i2c4 {
	status = "okay";

	// PSU
	psu0:psu0@58 {
		compatible = "pmbus";
		reg = <0x58>;
		/* Due to some PSUs support fan
		   but the FAN_CONFIG_1_2 (0x3A) and FAN_CONFIG_3_4 (0x3D) may not support
		   e.g. P2000 Series PSU. So add a node to set fan_config value.
		*/
		// set fan_1_2 installed and duty cycle mode; fan_3_4 uninstalled
		fan_configs = /bits/ 8 <0x88 0x00>;
	};
};

&i2c6 {
	status = "okay";

	//bp_HSC
	bp_hsc:adm1278@12 {
		compatible = "adm1278";
		reg = <0x12>;
		//Rsense = <500>;  // the value need to be fine tune in future
	};

	//MB HSC
	hsc:adm1278@11 {
		compatible = "adm1278";
		reg = <0x11>;
		//-shunt-resistor-micro-ohms = <0.2>;  // Err, This value should be integer
                // Below property only support on adm1278
                // averaging sample  <0>- dis, <1>- 2 sample, <2>- 4, <3>- 8, <4>- 16, <5>- 32, <6>- 64, <7>- 128
                pwr-avg-samples = <4>;
                // averaging sample  <0>- dis, <1>- 2 sample, <2>- 4, <3>- 8, <4>- 16, <5>- 32, <6>- 64, <7>- 128
                vi-avg-samples = <4>;
	};
};

&i2c7 {
	status = "okay";

	i2c-switch@70 {
		compatible = "nxp,pca9546";
		reg = <0x70>;
		#address-cells = <1>;
		#size-cells = <0>;
		//i2c-mux-idle-disconnect;

		m2_0: i2c@0 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <0>;
		};

		m2_1: i2c@1 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <1>;
		};

		ocp_front_0: i2c@2 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <2>;
		};
	};

	i2c-switch@71 {
		compatible = "nxp,pca9546";
		reg = <0x71>;
		#address-cells = <1>;
		#size-cells = <0>;
		//i2c-mux-idle-disconnect;

		pcie_riser1: i2c@0 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <0>;
		};

		pcie_riser2: i2c@1 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <1>;
		};

		ocp_front1: i2c@2 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <2>;
		};

		minisas: i2c@3 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <3>;
		};
	};
};

&i2c8 {
	status = "okay";
};

&i2c9 {
	status = "okay";
};

&i2c14 {
	status = "okay";

	//CKMNG+ SCM_CPLD TMP421

	// SCM fru
	scm_fruid: m24128_fru@50 {
		compatible = "atmel,24c128";
		reg = <0x50>;
		pagesize = <64>;
	};

	scm_temp: tmp421@4e {
		compatible = "ti,tmp421";
		reg = <0x4e>;
	};

	tpm_module: tpm@6e {
		compatible = "infineon,slb9645tt";
		reg = <0x6e>;
	};
};

&i2c15 {
	status = "okay";
};

&ehci1 {
	status = "okay";
};

&vhub {
	status = "okay";
};

// &sgpiom0 {
// 	status = "okay";
// };

&gpio0 {
    status = "okay";
    gpio-line-names =
    /*A0-A7*/   "","","","","","","","",
    /*B0-B7*/   "","","","","","","","",
    /*C0-C7*/   "","","","","","","","",
    /*D0-D7*/   "","","","","","","","",
    /*E0-E7*/   "","","","","","","","",
    /*F0-F7*/   "","POWER_OUT","","","","","","",
    /*G0-G7*/   "","","","","","","","",
    /*H0-H7*/   "","","","","","","","",
    /*I0-I7*/   "","","","","","","","CPU_PROCHOT",
    /*J0-J7*/   "","","","","","","","",
    /*K0-K7*/   "","","","","","","","",
    /*L0-L7*/   "","","","","","","","",
    /*M0-M7*/   "PS_PWROK","","NMI_BUTTON","","","","","",
    /*N0-N7*/   "NMI_OUT","","CPU_THERMAL_TRIP","","","","","",
    /*O0-O7*/   "","","","","","","MEM_HOT","",
    /*P0-P7*/   "RESET_BUTTON","RESET_OUT","","","PCH_THERMAL_TRIP","","","",
    /*Q0-Q7*/   "","","","","","","","",
    /*R0-R7*/   "","","","","","","POWER_BUTTON","",
    /*S0-S7*/   "","","","","","","","",
    /*T0-T7*/   "","","","","","","","",
    /*U0-U7*/   "","","","","","","","",
    /*V0-V7*/   "","","","","POST_COMPLETE","","","",
    /*W0-W7*/   "","","","","","","","",
    /*X0-X7*/   "","","","","","","","",
    /*Y0-Y7*/   "","","","","","","","",
    /*Z0-Z7*/   "","","","","","","","",
    /*AA0-AA7*/ "","","","","","","","",
    /*AB0-AB7*/ "","","","","","","","",
    /*AC0-AC7*/ "","","","","","","","";
};


&jtag0 {
        status = "okay";
};

