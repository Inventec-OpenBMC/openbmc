From ad2f1d1dba3209604e98a60853f60ff5a0065f76 Mon Sep 17 00:00:00 2001
From: "Lin.TommySC" <lin.tommysc@inventec.com>
Date: Wed, 13 Jan 2021 05:23:07 +0000
Subject: [PATCH 21/21] Enhance p2a-ctrl driver security

---
 drivers/soc/aspeed/aspeed-p2a2600-ctrl.c | 14 +++-----------
 1 file changed, 3 insertions(+), 11 deletions(-)

diff --git a/drivers/soc/aspeed/aspeed-p2a2600-ctrl.c b/drivers/soc/aspeed/aspeed-p2a2600-ctrl.c
index ba6a774..9db8142 100644
--- a/drivers/soc/aspeed/aspeed-p2a2600-ctrl.c
+++ b/drivers/soc/aspeed/aspeed-p2a2600-ctrl.c
@@ -43,8 +43,8 @@
  */
 #define SCUC20_ENP2A BIT(1)
 
-/* The ast2600 both have six ranges. */
-#define P2A_REGION_COUNT 6
+/* The ast2600 both have only 1 restricted range. */
+#define P2A_REGION_COUNT 1
 
 struct region {
 	u64 min;
@@ -400,18 +400,10 @@ static int aspeed_p2a_ctrl_remove(struct platform_device *pdev)
 }
 
 #define SCU0C0_DRAM	BIT(25)
-#define SCU0C0_SPI	BIT(24)
-#define SCU0C0_SOC	BIT(23)
-#define SCU0C0_FLASH	BIT(22)
 
 static const struct aspeed_p2a_model_data ast2600_model_data = {
 	.regions = {
-		{0x00000000, 0x0FFFFFFF, SCU0C0_FLASH},
-		{0x10000000, 0x1FFFFFFF, SCU0C0_SOC},
-		{0x20000000, 0x3FFFFFFF, SCU0C0_FLASH},
-		{0x40000000, 0x5FFFFFFF, SCU0C0_SOC},
-		{0x60000000, 0x7FFFFFFF, SCU0C0_SPI},
-		{0x80000000, 0xFFFFFFFF, SCU0C0_DRAM},
+		{0x9d720000, 0x9d75ffff, SCU0C0_DRAM},
 	}
 };
 
-- 
2.7.4

