From 4e53806e6f9918d1b0c159429755d7549c493fcf Mon Sep 17 00:00:00 2001
From: "pj.chen" <chen.pj@inventec.com>
Date: Wed, 3 Feb 2021 06:27:21 +0000
Subject: [PATCH] - Fix index for fan0 and pwm0

---
 src/FanMain.cpp | 12 ++++++++----
 1 file changed, 8 insertions(+), 4 deletions(-)

diff --git a/src/FanMain.cpp b/src/FanMain.cpp
index d2c124c..d4a0f37 100644
--- a/src/FanMain.cpp
+++ b/src/FanMain.cpp
@@ -277,6 +277,7 @@ void createSensors(
                 FanTypes fanType = getFanType(directory);
                 size_t bus = 0;
                 size_t address = 0;
+
                 if (fanType == FanTypes::i2c)
                 {
                     /*
@@ -301,8 +302,10 @@ void createSensors(
                     bus = std::stoi(link.substr(0, findDash));
                     address = std::stoi(link.substr(findDash + 1), nullptr, 16);
                 }
+                /* Fix for fan0_input */
                 // convert to 0 based
-                size_t index = std::stoul(indexStr) - 1;
+                //size_t index = std::stoul(indexStr) - 1;
+                size_t index = std::stoul(indexStr);
 
                 const char* baseType;
                 const SensorData* sensorData = nullptr;
@@ -561,7 +564,6 @@ void createSensors(
                             led = *ledName;
                         }
                     }
-
                 }
 
                 findLimits(limits, baseConfiguration);
@@ -594,8 +596,10 @@ void createSensors(
                 for (auto itr = pwmNumbers.begin(); itr != pwmNumbers.end(); itr++)
                 {
                     auto &[index, configPath, name, conetrName, is_used] = *itr;
-                    if (!is_used &&(pwm.filename().string() ==
-                        "pwm" + std::to_string(index + 1)))
+                    //if (!is_used &&(pwm.filename().string() ==
+                    //    "pwm" + std::to_string(index + 1)))
+                    if (!is_used && (pwm.filename().string() == 
+                        "pwm" + std::to_string(index)))
                     {
                         path = &configPath;
                         pwmName = &name;
-- 
2.7.4

